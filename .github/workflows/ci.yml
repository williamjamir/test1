name: My Check

on:
  push:

jobs:
  
  check: 
    runs-on: ubuntu-latest
    steps: 

      - name: Clone repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: get deploy environments
        id: deployEnv
        run: |
          deploy_environments=[]
          is_develop_branch=$([[ "${{ github.ref }}" == refs/heads/develop ]] && echo true || echo false)
          is_production_branch=$([[ "${{ github.ref }}" == refs/heads/main ]] && echo true || echo false)
          is_production_synced_with_develop=$(git cherry origin/main origin/develop)

          echo "Is develop: ${is_develop_branch}"
          echo "Is prod: ${is_production_branch}"
          echo "Is synced: ${is_production_synced_with_develop}"
          
          deploy_environments=""
          if [[ $is_develop_branch == true ]]; then
              deploy_environments="staging"
          elif [[ $is_production_branch == true ]] && [[ -n $is_production_synced_with_develop ]]; then
              deploy_environments="${{ inputs.production_environments }}"
          elif [[ $is_production_branch == true ]] && [[ -z $is_production_synced_with_develop ]]; then
              echo "::error::Cannot deploy out of sync production branch to production environments: ${{ inputs.production_environments }}"
          echo "deploy_environments=[${deploy_environments}]" >> $GITHUB_OUTPUT
          echo "${deploy_environments}"
            
